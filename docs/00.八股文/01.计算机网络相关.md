---
title: 计算机网络相关
date: 2022-02-20 17:51:30
permalink: /pages/8c93cc/
sidebar: auto
categories:
  - 八股文
tags:
  - 
---
## TCP的三次握手与四次挥手

### 三次握手

## ![](https://pic-xiaocao123-1304191709.cos.ap-guangzhou.myqcloud.com/image-20220220175234960.png)

1. 客户端发送链接请求携带`SYN`询问是否能够建立连接
2. 服务端收到后发送`SYN`包和`ACK`包确认连接。
3. 客户端收到服务端的确认连接后，发送`ACK`包到服务端，连接建立

##### 三次握手而不是两次握手的原因

客户端发送一次`SYN1`包给服务端，因为网络原因没有发送到服务端。这时客户端再次发送一个`SYN`包给予服务端，服务端收到后返回`ACK`包。

如果此时第一次发送的`SYN1`包网络突然回复发送到了服务端，此时如果是两次握手就建立连接的情况下,会**多建立一个网络连接**。所以采用三次握手，**就是为了解决网络信道连接不可靠的问题**。

#### 如何保证可靠连接

![image-20220220180246220](https://pic-xiaocao123-1304191709.cos.ap-guangzhou.myqcloud.com/image-20220220180246220.png)

1. 每个连接都有一个发送缓冲区
2. 发送时从发送时从发送缓冲区取一部分报文，加上序列号和长度。
3. 回复确认需要携带的`ACK`包需要通过序列号的长度确认：`ACK = 序列号 + 长度 = 下一包起始序列号`
4. 接收端可以根据序列号的长度重组数据，如果此时发生丢包，接收端还可以根据序列号，要求发送端再次发送该数据包到接收端。

### TCP的四次挥手

![image-20220220180335420](https://pic-xiaocao123-1304191709.cos.ap-guangzhou.myqcloud.com/image-20220220180335420.png)

1. **第一次握手**：<font color="#f52443">**客户端**</font>发起`FIN`包表示关闭连接
2. **第二次挥手**：<font color = "#8dbcf4">**服务端**</font>发送`ACK`包到<font color="#f52443">**客户端**</font>进入关闭等待状态
3. **第三次挥手**：<font color = "#8dbcf4">**服务端**</font>发送`FIN`包到<font color="#f52443">**客户端**</font>进入发送等待
4. **第四次挥手**：<font color="#f52443">**客户端**</font>接收后发送`ACK`包到<font color = "#8dbcf4">**服务端**</font>，<font color="#f52443">**客户端**</font>进入超时等待状态，超时后关闭连接。<font color = "#8dbcf4">**服务端**</font>立即关闭连接

*此时<font color="#f52443">**客户端**</font>有一个超时等待状态，是因为如果当`ACK`包发送因为网络原因如果未被<font color = "#8dbcf4">**服务端**</font>接收到时，<font color = "#8dbcf4">**服务端**</font>再次尝试发送`FIN`包请求关闭<font color="#f52443">**客户端**</font>仍可以收到请求，进入正常关闭流程。*

### TCP与UDP的差异与使用场景

1. TCP：稳定可靠，但是比较消耗资源。
   - :file_folder: 文件发送
   - :email: 邮件发送
   - :globe_with_meridians: 浏览网页等场景
2. UDP：无状态，速度快但是不可靠的网络传输。适用于对信息实时要求较高的场景。
   - :link: 域名查询
   - :mobile_phone_off: 语音通话
   - :tv: 视频直播等
